<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <title>Ховд 457 – 3D Танилцуулга</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/three@0.160.0/build/three.module.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/jsm/loaders/OBJLoader.js"></script>
  <style>
    body { margin:0; overflow:hidden; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script type="module">
    mapboxgl.accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v10',
      center: [102.1749, 44.6702],
      zoom: 15,
      pitch: 60,
      antialias: true
    });

    const threeLayer = {
      id: '3d-view',
      type: 'custom',
      renderingMode: '3d',
      onAdd: function(map, gl) {
        this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        this.scene = new THREE.Scene();
        this.renderer = new THREE.WebGLRenderer({canvas: map.getCanvas(), context: gl, antialias: true});
        this.renderer.autoClear = false;

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(0, 50, 50).normalize();
        this.scene.add(light);

        const loader = new THREE.OBJLoader();
        loader.load('3d 457.obj', object => {
          object.scale.set(0.05, 0.05, 0.05);
          object.position.set(0, 0, 0);
          this.scene.add(object);
        });
      },
      render: function(gl, matrix) {
        const m = new THREE.Matrix4().fromArray(matrix);
        this.camera.projectionMatrix = m;
        this.renderer.state.reset();
        this.renderer.render(this.scene, this.camera);
        map.triggerRepaint();
      }
    };

    map.on('style.load', () => {
      map.addLayer(threeLayer);
    });
  </script>
</body>
</html>
